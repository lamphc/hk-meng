{"version":3,"sources":["utils/api/user.js","pages/Login/index.module.css","pages/Login/index.js"],"names":["login","data","axios","post","getUserInfo","get","logout","getUserHouses","uploadHouseImgs","pubHouse","module","exports","Login","this","props","values","errors","handleChange","handleSubmit","console","log","className","styles","root","mode","size","onSubmit","formItem","input","name","value","username","onChange","placeholder","error","type","password","formSubmit","submit","backHome","Item","to","Component","withFormik","mapPropsToValues","validationSchema","yup","shape","required","matches","formikBag","a","async","res","status","setToken","token","history","state","location","backUrl","replace","go","offline","description"],"mappings":"mHAAA,uNAMaA,EAAQ,SAACC,GACpB,OAAOC,IAAMC,KAAK,cAAeF,IAItBG,EAAc,WACzB,OAAOF,IAAMG,IAAI,UAINC,EAAS,WACpB,OAAOJ,IAAMC,KAAK,iBAIPI,EAAgB,WAC3B,OAAOL,IAAMG,IAAI,iBAING,EAAkB,SAACP,GAC9B,OAAOC,IAAMC,KAAN,gBAA4BF,IAIxBQ,EAAW,SAACR,GACvB,OAAOC,IAAMC,KAAK,eAAgBF,K,oBC/BpCS,EAAOC,QAAU,CAAC,KAAO,oBAAoB,UAAY,yBAAyB,SAAW,wBAAwB,SAAW,wBAAwB,MAAQ,qBAAqB,WAAa,0BAA0B,OAAS,sBAAsB,MAAQ,uB,sTCe7PC,E,iLAqCM,IAAD,EAMYC,KAAKC,MAJtBC,EAFK,EAELA,OAEAC,EAJK,EAILA,OACAC,EALK,EAKLA,aACAC,EANK,EAMLA,aAGF,OAFAC,QAAQC,IAAIP,KAAKC,OAGf,yBAAKO,UAAWC,IAAOC,MAErB,uBAAQC,KAAK,SAAb,4BAGA,uBAAYC,KAAK,OAGjB,2BACE,0BAAMC,SAAUR,GACd,yBAAKG,UAAWC,IAAOK,UACrB,2BACEN,UAAWC,IAAOM,MAClBC,KAAK,WACLC,MAAOf,EAAOgB,SACdC,SAAUf,EACVgB,YAAY,oCAIfjB,EAAOe,UAAY,yBAAKV,UAAWC,IAAOY,OAAQlB,EAAOe,UAC1D,yBAAKV,UAAWC,IAAOK,UACrB,2BACEN,UAAWC,IAAOM,MAClBC,KAAK,WACLM,KAAK,WACLL,MAAOf,EAAOqB,SACdJ,SAAUf,EACVgB,YAAY,oCAIfjB,EAAOoB,UAAY,yBAAKf,UAAWC,IAAOY,OAAQlB,EAAOoB,UAC1D,yBAAKf,UAAWC,IAAOe,YACrB,4BAAQhB,UAAWC,IAAOgB,OAAQH,KAAK,UAAvC,mBAKJ,uBAAMd,UAAWC,IAAOiB,UACtB,sBAAMC,KAAN,KACE,kBAAC,IAAD,CAAMC,GAAG,YAAT,mE,GAxFMC,aAiGLC,sBAAW,CAExBC,iBAAkB,iBAAO,CAAEb,SAAU,QAASK,SAAU,UAExDS,iBAAkBC,MAAaC,MAAM,CACnChB,SAAUe,MAAaE,SAAS,8CAAWC,QAzG7B,qBAyGgD,oIAC9Db,SAAUU,MAAaE,SAAS,8CAAWC,QAzG/B,sBAyGgD,uIAI9D/B,aAAc,SAAOH,EAAQmC,GAAf,2BAAAC,EAAAC,OAAA,uDACZjC,QAAQC,IAAI8B,GACJnB,EAAuBhB,EAAvBgB,SAAUK,EAAarB,EAAbqB,SAClBjB,QAAQC,IAAIW,EAAUK,GAClBnC,EAAO,CACT8B,WACAK,YANU,WAAAe,EAAA,MAQInD,YAAMC,IARV,OAQRoD,EARQ,OASZlC,QAAQC,IAAIiC,GACO,MAAfA,EAAIC,QACNC,YAASF,EAAIpD,KAAKuD,OADI,EAEmBN,EAAUpC,MAA3C2C,EAFc,EAEdA,SAAqBC,EAFP,EAELC,SAAYD,QAChBA,EAAME,QACjBH,EAAQI,QAAQH,EAAME,SAEtBH,EAAQK,IAAI,IAGd,IAAMC,QAAQV,EAAIW,aAnBR,uCAVDrB,CAgCZ/B","file":"static/js/15.784d61ac.chunk.js","sourcesContent":["/**\n * 用户\n */\nimport axios from '../axios';\n\n// 登录\nexport const login = (data) => {\n  return axios.post('/user/login', data)\n}\n\n// 获取登录用户信息\nexport const getUserInfo = () => {\n  return axios.get('/user')\n}\n\n// 退出登录\nexport const logout = () => {\n  return axios.post('/user/logout')\n}\n\n// 获取已发布房源 \nexport const getUserHouses = () => {\n  return axios.get('/user/houses')\n}\n\n// 上传房源图片\nexport const uploadHouseImgs = (data) => {\n  return axios.post(`/houses/image`, data)\n}\n\n// 发布房源 \nexport const pubHouse = (data) => {\n  return axios.post('/user/houses', data)\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Login_root__xpMLV\",\"navHeader\":\"Login_navHeader__15hA9\",\"backHome\":\"Login_backHome__uoXiv\",\"formItem\":\"Login_formItem__2h67j\",\"input\":\"Login_input__2pNlW\",\"formSubmit\":\"Login_formSubmit__13nn8\",\"submit\":\"Login_submit__3Xx64\",\"error\":\"Login_error__WN4FS\"};","import React, { Component } from 'react'\r\nimport { Flex, WingBlank, WhiteSpace, NavBar, Toast } from 'antd-mobile'\r\n\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport styles from './index.module.css'\r\nimport { login } from '../../utils/api/user'\r\nimport { setToken } from '../../utils'\r\n\r\nimport { withFormik } from 'formik'\r\nimport * as yup from 'yup'\r\n\r\n// 验证规则：\r\nconst REG_UNAME = /^[a-zA-Z_\\d]{5,8}$/\r\nconst REG_PWD = /^[a-zA-Z_\\d]{5,12}$/\r\n\r\nclass Login extends Component {\r\n  // state = {\r\n  //   username: '',\r\n  //   password: ''\r\n  // }\r\n\r\n  // // 处理表单输入\r\n  // handlerForm = (e) => {\r\n  //   // console.log(e);\r\n  //   let name = e.target.name;\r\n  //   this.setState({\r\n  //     [name]: e.target.value\r\n  //   })\r\n  // }\r\n\r\n  // 处理登录\r\n  // handlerLogin = async (e) => {\r\n  //   // 阻止表单默认action行为\r\n  //   e.preventDefault();\r\n  //   console.log(this.state.username, this.state.password);\r\n  //   const { username, password } = this.state;\r\n  //   let data = {\r\n  //     username,\r\n  //     password\r\n  //   }\r\n  //   let res = await login(data);\r\n  //   console.log(res)\r\n  //   if (res.status === 200) {\r\n  //     setLocalData(TOKEN, res.data.token);\r\n  //     this.props.history.push('/')\r\n  //   } else {\r\n  //     Toast.offline(res.description)\r\n  //   }\r\n  // }\r\n\r\n\r\n\r\n  render() {\r\n    const {\r\n      values,\r\n      // touched,\r\n      errors,\r\n      handleChange,\r\n      handleSubmit } = this.props;\r\n    console.log(this.props)\r\n    // console.log(touched, errors)\r\n    return (\r\n      <div className={styles.root}>\r\n        {/* 顶部导航 */}\r\n        <NavBar mode=\"light\">\r\n          账号登录\r\n        </NavBar>\r\n        <WhiteSpace size=\"xl\" />\r\n\r\n        {/* 登录表单 */}\r\n        <WingBlank>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className={styles.formItem}>\r\n              <input\r\n                className={styles.input}\r\n                name=\"username\"\r\n                value={values.username}\r\n                onChange={handleChange}\r\n                placeholder=\"请输入账号\"\r\n              />\r\n            </div>\r\n            {/* 长度为5到8位，只能出现数字、字母、下划线 */}\r\n            {errors.username && <div className={styles.error}>{errors.username}</div>}\r\n            <div className={styles.formItem}>\r\n              <input\r\n                className={styles.input}\r\n                name=\"password\"\r\n                type=\"password\"\r\n                value={values.password}\r\n                onChange={handleChange}\r\n                placeholder=\"请输入密码\"\r\n              />\r\n            </div>\r\n            {/* 长度为5到12位，只能出现数字、字母、下划线 */}\r\n            {errors.password && <div className={styles.error}>{errors.password}</div>}\r\n            <div className={styles.formSubmit}>\r\n              <button className={styles.submit} type=\"submit\">\r\n                登 录\r\n              </button>\r\n            </div>\r\n          </form>\r\n          <Flex className={styles.backHome}>\r\n            <Flex.Item>\r\n              <Link to=\"/registe\">还没有账号，去注册~</Link>\r\n            </Flex.Item>\r\n          </Flex>\r\n        </WingBlank>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withFormik({\r\n  // 提供表单的状态数据和当前表单的input的name属性值一一对应\r\n  mapPropsToValues: () => ({ username: 'test2', password: 'test2' }),\r\n  // 验证表单\r\n  validationSchema: yup.object().shape({\r\n    username: yup.string().required('账号为必填项！').matches(REG_UNAME, '账号长度为5到8位，只能出现数字、字母、下划线'),\r\n    password: yup.string().required('密码为必填项！').matches(REG_PWD, '密码长度为5到12位，只能出现数字、字母、下划线'),\r\n  }),\r\n  // 处理表单提交\r\n  // handleSubmit: (values: Values, formikBag: FormikBag) => void | Promise<any>\r\n  handleSubmit: async (values, formikBag) => {\r\n    console.log(formikBag)\r\n    const { username, password } = values;\r\n    console.log(username, password)\r\n    let data = {\r\n      username,\r\n      password\r\n    }\r\n    let res = await login(data);\r\n    console.log(res)\r\n    if (res.status === 200) {\r\n      setToken(res.data.token);\r\n      const { history, location: { state } } = formikBag.props;\r\n      if (state && state.backUrl) {\r\n        history.replace(state.backUrl)\r\n      } else {\r\n        history.go(-1)\r\n      }\r\n    } else {\r\n      Toast.offline(res.description)\r\n    }\r\n  },\r\n})(Login)\r\n"],"sourceRoot":""}